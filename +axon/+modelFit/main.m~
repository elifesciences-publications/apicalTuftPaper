addpath(genpath('/home/alik/code/fastfit'));
addpath(genpath('/home/alik/code/lightspeed'));

% Get the values
[synCount,~,~]=axon.extractInfoInhibitoryAxons;
layer2Matrix=synCount{1,5}{:,2:end};
layer2Matrix=layer2Matrix(:,[1,2,4,5,6,3,7,8]);
deepMatrix=synCount{2,5}{:,2:end};
deepMatrix=deepMatrix(:,[1,2,4,5,6,3,7,8]);

%% multinomial MLE= fractions
nL2=sum(layer2Matrix,1);
nDL=sum(deepMatrix,1);
mleL2=nL2./sum(nL2);
mleDL=nDL./sum(nDL);
numberOfSamples=10000;
bootStrapSampleL2=mnrnd(sum(nL2),mleL2,numberOfSamples);
mleBootStrapL2=bootStrapSampleL2./sum(bootStrapSampleL2,2);
meansL2=mean(mleBootStrapL2,1);
errorL2=diff(prctile(mleBootStrapL2,[0.05 0.95],1),1)./2;

bootStrapSampleDL=mnrnd(sum(nDL),mleDL,numberOfSamples);
mleBootStrapDL=bootStrapSampleDL./sum(bootStrapSampleDL,2);
meansDL=mean(mleBootStrapDL,1);
errorDL=diff(prctile(mleBootStrapDL,[0.05 0.95],1),1)./2;
fh=figure;ax=gca;
x_width=20;
y_width=20;
hold on
errorbar(meansL2,errorL2,'Color',l2color);
errorbar(meansDL,errorDL,'Color',dlcolor);
outputDir='/mnt/mpibr/data/Data/karimia/presentationsWriting/Talks/progressReport06082018/'
xticklabels(synCount{1,1}(:,[2,3,5,6,7,4,8,9]).Properties.VariableNames);
xtickangle(-45)
ylim([0 1]);
xlim([0.5 length(means)+0.5]);
ylabel('Multinomial parameter');
util.cosmeticsSave(fh,ax,x_width,y_width,outputDir,'MultinomialModel');


%% Polya fit model

deepPolyaFitALpha=polya_fit(deepMatrix);
l2PolyaFitALpha=polya_fit(layer2Matrix);
numberOfSamples=10000;
bootStrapMLEs=zeros(numberOfSamples,length(deepPolyaFitALpha));
for sample=numberOfSamples
    curBootStrapSample.l2=axon.polyaFit.bootStrapSample...
        (l2PolyaFitALpha,layer2Matrix);
    curBootStrapSample.dl=axon.polyaFit.bootStrapSample...
        (l2PolyaFitALpha,layer2Matrix);
    polya_fit(curBootStrapSample.l2);
    polya_fit(curBootStrapSample.dl)
    

end



deepPolyaFitALpha=deepPolyaFitALpha./sum(deepPolyaFitALpha);
l2PolyaFitALpha=l2PolyaFitALpha./sum(l2PolyaFitALpha);
fh=figure;ax=gca;
x_width=20;
y_width=20;
hold on
plot(l2PolyaFitALpha,'Color',l2color);
plot(deepPolyaFitALpha,'Color',dlcolor);

xticklabels(synCount{1,1}(:,[2,3,5,6,7,4,8,9]).Properties.VariableNames);
xtickangle(-45)
ylim([0 1]);
ylabel('Mean of Polya model')
xlim([0.5 length(means)+0.5]);
util.cosmeticsSave(fh,ax,x_width,y_width,outputDir,'polyaModel');


